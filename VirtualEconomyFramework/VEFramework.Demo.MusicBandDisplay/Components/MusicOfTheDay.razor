@using Markdig
@inject AppData AppData
@inherits BaseNFTComponent

@if (NFT != null)
{
    var videoLink = GetVideo();

    <Row Flex="Flex.AlignItems.Center">
        <Column Flex="Flex.JustifyContent.Center">
            <Heading Size="HeadingSize.Is3" Style="text-decoration: underline;">Music Of the Day</Heading>
        </Column>
    </Row>
    <Row Class="profileofthedaybox" Margin="Margin.Is2.FromTop">
        <Column ColumnSize="ColumnSize.Is12.OnMobile.Is12.OnTablet.Is4.OnDesktop" Padding="Padding.Is2">
            @if (string.IsNullOrEmpty(videoLink))
            {
                <Row Margin="Margin.Is3.FromTop">
                    <Column Flex="Flex.JustifyContent.Center.AlignItems.Center">
                        <Image Source="@NFT.ImageLink" Style="max-width:350px;" />
                    </Column>
                </Row>
            }
            else
            {
                <Row>
                    <Column Flex="Flex.JustifyContent.Center.AlignItems.Center">
                        <Image Source="@NFT.ImageLink" Style="max-width:200px;" />
                    </Column>
                </Row>
            }
            <Row>
                <Column Flex="Flex.JustifyContent.Center">
                    <Span TextColor="TextColor.Dark">@(NFT.Name)</Span>
                </Column>
            </Row>
        </Column>
        <Column ColumnSize="ColumnSize.Is12.OnMobile.Is12.OnTablet.Is8.OnDesktop" Flex="Flex.AlignItems.Center">
            <Div>
                @if (!string.IsNullOrEmpty(NFT.Description))
                {
                    <Row Margin="Margin.Is2.FromTop">
                        <Column Padding="Padding.Is2">
                            @((MarkupString)NFT.Description)
                        </Column>
                    </Row>
                }
                <Row Margin="Margin.Is2.FromTop">
                    <Column>
                            <Span Class="text-wrap">
                                @((MarkupString)NFTTextMarkuptext)
                            </Span>         
                    </Column>
                </Row>
                <Row Margin="Margin.Is3.FromTop.Is2.FromBottom">
                    <Column>
                        @foreach(var tag in NFT.TagsList)
                        {                    
                            <Badge Color="Color.Secondary" Margin="Margin.Is2.FromEnd">#@tag</Badge>
                        }
                    </Column>
                </Row>
            </Div>
        </Column>
    </Row>
}

@code {

    public string GetVideo()
    {
        if (NFT.DataItems.Count > 0)
        {
            foreach(var item in NFT.DataItems)
            {
                if (item.Type == Services.NFTs.Dtos.DataItemType.AVMedia)
                {
                    var videoFileLink = NFTHelpers.GetIPFSLinkFromHash(item.Hash);
                    return videoFileLink;
                }
            }
        }
        return string.Empty;
    }
}
